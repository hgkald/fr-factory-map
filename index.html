<!DOCTYPE html>
<html>
<head>
	
	<title>FR Partner Factory Map</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
	
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>

	<!--<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">-->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet">
	
	<link rel="stylesheet" href="./css/MarkerCluster.css" />
	<link rel="stylesheet" href="./css/MarkerCluster.Default.css" />
	<script src="./js/leaflet.markercluster-src.js"></script>
	
	<link rel="stylesheet" href="./css/leaflet-sidebar.css" />
	<script src="./js/leaflet-sidebar.js"></script>

	<link rel="stylesheet" href="./css/leaflet.zoomhome.css"/>
	<script src="./js/leaflet.zoomhome.js"></script>

	<link rel="stylesheet" href="./css/L.Icon.FontAwesome.css"/>
	<script src="./js/L.Icon.FontAwesome.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

	<script src="./js/subgroup.js"></script>

	<style>
		html, body, #map {
			height: 100%;
			width: 100vw; 
			margin: 0;
			font: 11pt "Helvetica Neue", Arial, Helvetica, sans-serif;
		}

		tr:nth-child(odd) {background-color: #f2f2f2;}

	</style>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-150529309-1"></script>
        <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());

                gtag('config', 'UA-150529309-1');
        </script>


	<script src="./data/UNIQLO_COREFABRICMILLS_GEOCODED.js" type="text/javascript"></script>
	<script src="./data/FR_GEOCODED_FACTORIES.js" type="text/javascript"></script>
</head>




<body>

	<div id="sidebar" class="sidebar collapsed">
		<!-- Nav tabs -->
		<div class="sidebar-tabs">
			<ul role="tablist">
				<li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
				<li><a href="#info" role="tab"><i class="fa fa-info-circle"></i></a></li>
			</ul>
			<ul role="tablist">
				<li><a href="https://github.com/hgonzal/fr-factory-map" role="tab" target="_blank"><i class="fab fa-github"></i></a></li>
			</ul>
		</div>

		<!-- Tab panes -->
		<div class="sidebar-content">
			<div class="sidebar-pane" id="home">
				<h1 class="sidebar-header">
					Fast Retailing Partner Factory Map <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
				</h1>
				<p><a title="FAST RETAILING [Public domain], via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:FAST_RETAILING_logo.svg"><img width="60%" alt="FAST RETAILING logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/FAST_RETAILING_logo.svg/256px-FAST_RETAILING_logo.svg.png"></a></p>
				<p>
					<a title="UNIQLO [Public domain], via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:UNIQLO_logo.svg"><img width="30%" alt="UNIQLO logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/UNIQLO_logo.svg/128px-UNIQLO_logo.svg.png"></a> 
					<a title="G.U. CO., LTD. [Public domain], via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:GU_logo.svg"><img width="30%" alt="GU logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/GU_logo.svg/128px-GU_logo.svg.png"></a>
				</p>
				<p>This page visualizes the factories provided by Fast Retailing <a href='https://www.fastretailing.com/eng/sustainability/labor/list.html'>from their official partner factory list</a>. According to FR, there are 242 Uniqlo and GU core sewing factories and 49 core UNIQLO fabric mills, as visualized here.</p>
				<p>Note that this is <b>not</b> an official Fast Retailing map and that locations are approximated from the provided factory names and addresses. </p>

			</div>

			<div class="sidebar-pane" id="info">
				<h1 class="sidebar-header">Information<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<h3>Disclaimer</h3><p>The locations specified here are <b>approximate</b> and based on the factory names and addresses provided by Fast Retailing. Some points may only be accurate to a city or state level and is meant for visualization purposes only.</p>
				<h3>How were the locations approximated?</h3>
				<p>The following steps were used to get the factory locations:</p><ol>
					<li>The  data was collected from Fast Retailing <a href="https://www.fastretailing.com/eng/sustainability/labor/list.html">from their website</a>. The main sources are:</li> <ul>
						<li>The <i>Fast Retailing Core Sewing Factory List</i>, dated March 2019. 
						<li>The <i>UNIQLO Core Fabric Mill List</i>, dated April 2019.
					</ul>
					<li>These were geocoded via the Google Cloud Geocoding API to get a latitude and longitude for each factory. It took multiple steps: <ul>
						<li>Factories were initially geocoded using the factory name. </li>
						<li>Factories in China were geocoded again by the factory address, as the factory names did not yield accurate locations.</li>
						<li>A small number of other factory names could not be found in the Google database, so these were geocoded via address instead. </li>
					</ul>
					<li>The resulting addresses were then manually checked for errors.<ul>
						<li>If a point was geocoded incorrectly, the closest verifiable location (e.g. street name, town, province/state) was used for that particular factory.</li>
						<li>Factories that were corrected manually in this way are noted in the map as <i>Modified = true</i>.</li>
					</li>
			</div>

			</div>
			<div class="sidebar-pane" id="settings">
				<h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
			</div>
		</div>
	</div>

	<!-- Display map -->
	<div id='map' class='sidebar-map'></div>
	
	<script>
		var map = L.map('map', {
			center: [15, 100],
    			zoom: 4,
			zoomControl: false
		});
		map.options.maxZoom = 12;
		var zoomHome = L.Control.zoomHome({position: 'topright'});
		zoomHome.addTo(map);

	        var sidebar = L.control.sidebar('sidebar').addTo(map);
        	//sidebar.open('home');

		var OSM_DE = L.tileLayer('https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
		});
		OSM_DE.addTo(map); 


		function createMarker(feature, latlng, iconConf, markerType) {
			var marker = L.marker(latlng, {
				icon: L.icon.fontAwesome(iconConf)
			});

			var popupProperties = ["Factory name","Factory address","formatted_address", "latlong", "geocoded_field"];
			var popupContent = '<table>';
			popupContent += '<h4>' + feature.properties['Factory name'] + '</h4>'
				+ '<tr><td><b>Type</b> </td><td>' + markerType + '</td></tr>'
				+ '<tr><td><b>Address</b> </td><td>' + feature.properties['Factory address'] + '</td></tr>'
				+ '<tr><td><b>Geocoded address</b></td><td>'+ feature.properties['formatted_address'] + '</td></tr>'
				+ '<tr><td><b>Lat/Long</b></td><td>'+ feature.properties['latlong'] + '</td></tr>';
			var modified = false;
			if (feature.properties["status"] == "MOD"){
				modified = true;
			}
			popupContent += '<tr><td>' + "<b>Modified</b>" + '</td><td>'+ modified + '</td></tr>';
			//marker.bindPopup(feature.properties['Factory name']);
			popupContent += '</table>';
			marker.bindPopup(popupContent);
			return marker; 
		}

		var mcg = L.markerClusterGroup().addTo(map);
		var factorySub = L.featureGroup.subGroup(mcg).addTo(map);
		var millSub = L.featureGroup.subGroup(mcg).addTo(map);

		var clusters = L.markerClusterGroup();
		var factoryLayer = L.geoJson(factoryJson, {
			pointToLayer: function (feature, latlng) {
				iconConf = {
					iconClasses: 'fas fa-warehouse',
					markerColor: 'green',
					iconColor: '#FFF'
				}

				return createMarker(feature, latlng, iconConf, 'Sewing factory');
			},
			onEachFeature: function (feature, layer) {
				layer.addTo(clusters);
			}
		});
		//map.addLayer(clusters);
		factoryLayer.addTo(factorySub)

		var millClusters = L.markerClusterGroup();
		var millLayer = L.geoJson(fabricMillJson, {
			pointToLayer: function (feature, latlng) {
				iconConf = {
					iconClasses: 'fas fa-warehouse',
					markerColor: 'darkblue',
					iconColor: '#FFF'
				}

				return createMarker(feature, latlng, iconConf, 'Fabric mill') 
			},
			onEachFeature: function (feature, layer) {
				layer.addTo(millClusters);
			}
		});
		//map.addLayer(millClusters);
		millLayer.addTo(millSub)

		var overlays = {
			"Fast Retailing Core Sewing Factories" : factorySub,
			"UNIQLO Core Fabric Mills" : millSub
		};

		L.control.layers(null, overlays, {collapsed:false, position:'bottomright'}).addTo(map);


	</script>

</body>
</html>

